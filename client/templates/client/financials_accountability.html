{% extends 'base.html' %}
{% load static %}
{% block title %} Financials Days Counter{% endblock title %}

{% block content %}
    {% if user.is_authenticated %}
        <h6 class="h6 mt-4">Financial Statements Days Counter</h6>     
        <form method="get" class="mt-2 mb-4">
            <div class="row g-3 mt-2">
                <div class="form-group col-md-4 mt-2">
                    {{ form.client_type.label_tag }}  
                    {{ form.client_type }} 
                </div>
                <div class="form-group col-md-4 mt-2">
                    {{ form.month.label_tag }}  
                    {{ form.month }}  
                </div>
                <div class="form-group col-md-4 mt-2">
                    {{ form.accountant.label_tag }}  
                    {{ form.accountant }} 
                </div>
             </div>
            <div class="row g-3 mt-2">
                <div class="form-group col-md-4 mt-2">
                    {{ form.years.label_tag }}  
                    {{ form.years }}  
                </div>

                    <div class="form-group col-md-4 mt-2">
                        {{ form.searchterm.label_tag }}  
                        {{ form.searchterm }}  
                    </div>
                    <div class="form-group col-md-4 mt-2">
                    <input type="hidden" class="form-label">&nbsp;</input> 
                    <button id="id_submit_btn" type="submit" class="btn btn-outline-primary w-100">Submit</button>
                    
                    </div>
            </div>
            </form>
    {% if is_valid %}
    <h6 class="h6 mt-4">Total found: {{count}}</h6>
    <table class="table table-striped table-hover table-bordered">
    {% include "client/_table_headers.html" with headers=headers %}
    <thead>
        <tr>
            <td>
            </td>
            <td>
                <select id="filter-year" class="form-select form-select-sm">
                    <option value="all">All</option>
                    {% for year in unique_years %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </td>
           
            <td>
                <select id="filter-afs-days" class="form-select form-select-sm">
                    <option value="all">All</option>
                    {% for day in unique_fin_days %}
                        <option value="{{day}}">{{day}}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select id="filter-afs" class="form-select form-select-sm">
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="incomplete">Incomplete</option>
                </select>
            </td>
            <td>
                <select id="filter-secretarial-days" class="form-select form-select-sm">
                    <option value="all">All</option>
                    {% for day in unique_sec_days %}
                        <option value="{{day}}">{{day}}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select id="filter-secretarial" class="form-select form-select-sm">
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="incomplete">Incomplete</option>
                </select>
            </td>
            <td>
                <select id="filter-tax-days" class="form-select form-select-sm">
                    <option value="all">All</option>
                    {% for day in unique_tax_days %}
                        <option value="{{day}}">{{day}}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select id="filter-tax" class="form-select form-select-sm">
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="incomplete">Incomplete</option>
                </select>
            </td>
            <td>
                <select id="filter-invoicing-days" class="form-select form-select-sm">
                    <option value="all">All</option>
                    {% for day in unique_inv_days %}
                        <option value="{{day}}">{{day}}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select id="filter-invoicing" class="form-select form-select-sm">
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="incomplete">Incomplete</option>
                </select>
            </td>
            
        </tr>
        <tr class="summary-row">
            <td id="filtered-row-count"></td>
            <td></td>
            <td>Max: {{max_dict.fin_days}}</td>
            <td></td>
            <td>Max: {{max_dict.sec_days}}</td>
            <td></td>
            <td>Max: {{max_dict.tax_days}}</td>
            <td></td>
            <td>Max: {{max_dict.invoicing_days}}</td>
            <td></td>
        </tr>
    </thead>
    <tbody>

        {% for id, record in data.items %}
            <tr>
                <td><a href="{% url 'client-detail' record.client_id %}" class="text-decoration-none">{{ record.get_client_full_name }}</a></td>
                <td>{{record.fy }}</td>
                
                <td>{{ record.fin_days }}</td>
                <td><button {% if record.fin_finished == "Completed" %} class="btn btn-success" {% else %}class="btn btn-warning" {% endif %}>{{record.fin_finished}}</button></td>
                
                <td>{{ record.sec_days }}</td>
                <td><button {% if record.sec_finished == "Completed" %} class="btn btn-success" {% else %}class="btn btn-warning" {% endif %}>{{record.sec_finished}}</button></td>
                
                <td>{{ record.tax_days }}</td>
                <td><button {% if record.tax_finished == "Completed" %} class="btn btn-success" {% else %}class="btn btn-warning" {% endif %}>{{record.tax_finished}}</button></td>
                
                <td>{{ record.invoicing_days }}</td>
                <td><button {% if record.invoicing_finished == "Completed" %} class="btn btn-success" {% else %}class="btn btn-warning" {% endif %}>{{record.invoicing_finished}}</button></td>
            </tr>
        {% endfor %}
    </tbody>
    </table>
    {% endif %}        
    {% endif %}
{% endblock %}
{% block extra_js %}
<!-- <script src="{% static 'js/financials_progress.js' %}"></script> -->
<script src="{% static 'js/searchClient.js' %}"></script>
<script src="{% static 'js/financialAccountability.js' %}"></script>
{% endblock extra_js %}